by Brian Tomasik
First written: Apr. 2015; last update: <REPLACE>date_of_last_update</REPLACE>

<span style="color:red">This piece is still a draft. Please give feedback. :)</span>

<h2>Summary</h2>

Investing with leverage means borrowing money to buy stocks/ETFs. It should theoretically amplify expected returns, and some argue that over a lifetime, it can even reduce risk through temporal diversification. Possible ways to achieve leverage include buying securities on margin, options, index futures, and leveraged ETFs. Among these choices, I incline toward buying index ETFs on margin because this is a relatively transparent way to achieve roughly 2X leverage. I'd like to learn more about using options and futures, but they at least appear disadvantageous from a tax perspective relative to buy-and-hold margin investments. Conventional wisdom considers leveraged ETFs a bad idea for buy-and-hold investors.

I simulated margin vs. regular investing and found that over <REPLACE>years_until_donate</REPLACE> years, for someone saving <REPLACE>initial_annual_income_for_investing</REPLACE>/year with a <REPLACE>annual_real_income_growth_percent</REPLACE>% real annual growth in savings and various other assumptions, using margin investing results in an expected present value of ~<REPLACE>margin_better_than_regular_thousands_of_dollars</REPLACE>K more eventual donatable savings than not using it, which is about a <REPLACE>margin_better_than_regular_percent</REPLACE>% improvement.

<h3>Note</h3>

I'm not an expert on leveraged investing. This piece represents my own efforts to explore this topic rather than solid advice from experience. There are probably errors in what I say, and I encourage readers to give me feedback. Also, this analysis assumes you live in the USA, and many details (especially about taxes) may not extend to other countries.

[toc]

<h2>Why leverage</h2>

<i><a href="http://smile.amazon.com/Lifecycle-Investing-Audacious-Performance-Retirement-ebook/dp/B003GYEGK2/">Lifecycle Investing</a></i> by Ian Ayres and Barry Nalebuff makes the case that most young people should <a href="http://en.wikipedia.org/wiki/Leverage_%28finance%29">leverage</a> their investments early in life. Here's a summary of the argument: "<a href="http://content.time.com/time/business/article/0,8599,1982327,00.html">Why Young People Should Buy Stocks on Margin</a>". The logic is almost obvious in hindsight, and if you expect a fairly normal professional career trajectory, it may apply to you.

For altruists, there's an additional reason to consider leverage: Many altruists should be more risk-neutral than most non-altruists. How much this is true <a href="http://reducing-suffering.org/when-should-altruists-be-financially-risk-averse/" title="&quot;When Should Altruists Be Financially Risk-Averse?&quot;">depends on</a> the charities that the altruist wants to support. Leverage offers the promise of higher expected returns in exchange for potentially higher risk. (That said, one of the theses of <i>Lifecycle Investing</i> is that leverage could also decrease lifetime risk if it allows you to reduce the aggressiveness of your investments in later years.)
<!--
TAKE THIS OUT BECAUSE IT'S ONLY A NAIVE ANALYSIS AND IS SUPERCEDED BY SIMULATION NUMBERS
<h2>How much is leverage worth?</h2>

The value of leverage depends on the current interest rate for borrowing and expected stock returns. As an example, in 2015, <a href="http://en.wikipedia.org/wiki/Margin_(finance)">margin</a> interest rates <a href="https://www.interactivebrokers.com/en/index.php?f=interest&p=schedule2" title="&quot;Interest Rates Charged to You on Margin Loan Balances&quot;">at Interactive Brokers</a> are less than 1.5% for large investment amounts. A conservative estimate of future stock returns might be 5%. This implies in expectation about a 3.5% net return per year. Suppose you have $500K to invest. If you use 2:1 leverage and borrow another $500K to invest, and if it returns a net 3.5%/year in expectation, that amounts to an extra $17.5K/year in expectation. Maybe we should reduce the expected returns to 2% to account for risk and the possibility of error. Then leverage is worth $10K/year in expectation. Over many years, this adds up to a nontrivial amount.

If you don't already have a lot to invest, the total gains from leverage will of course be lower. In this piece, I describe a simulation in which a hypothetical wage earner invests over the course of 30 years, contributing <REPLACE>initial_annual_income_for_investing</REPLACE>/year to savings in early years and up to $54K/year in late years. The results are presented <a href="#Results">later</a>.
-->

<h2>Possible leverage methods</h2>

Following are some methods that are often proposed for leveraging investments. I haven't tried any of them yet firsthand, though I hope to experiment with margin investing soon.

<h3>Margin</h3>

<a href="http://en.wikipedia.org/wiki/Margin_(finance)">Margin</a> investing involves borrowing money from a broker to buy additional stocks/ETFs. By far the <a href="http://investorjunkie.com/12389/best-margin-rates/" title="&quot;Best Margin Rates&quot;">best margin rates</a> are offered by Interactive Brokers. However, note that Interactive Brokers requires that you have a minimum account balance of <a href="https://www.interactivebrokers.com/en/index.php?f=4969" title="&quot;Required Minimums&quot;">$10K</a>, a minimum liquid net worth of <a href="https://www.interactivebrokers.com/en/?f=accountConfiguration&p=tradingrequirements" title="&quot;Financial Information Requirements&quot;">$100K</a>, and experience making at least <a href="https://www.interactivebrokers.com/en/?f=accountConfiguration&p=tradingrequirements" title="&quot;Financial Information Requirements&quot;">100 securities trades</a> on another platform.

<h4>Arguments for margin:</h4>

<ul>
<li>It's more clear that margin investing has the returns you'd expect, because it doesn't rely on market pricing of options and futures.</li>
<li>Unlike options, futures, and leveraged ETFs, if you buy stocks/ETFs on margin, you can hold them indefinitely unless you need to sell to rebalance your portfolio. This means you can potentially hold securities for many years and then donate them when you're ready, thereby never incurring capital-gains tax. In contrast, options and futures typically need to be sold at least once per year, and leveraged ETFs incur some tax costs through daily rebalancing. Frequent buying and selling also incurs some transactions costs via trading fees and bid-ask spreads.</li>
<li>In the USA, margin interest <a href="https://ttlc.intuit.com/questions/2260392-is-margin-interest-paid-tax-deductible">can offset</a> net investment income, thereby potentially reducing taxes.</li>
</ul>

<h4>Arguments against margin:</h4>

<ul>
<li>You can't achieve very high leverage ratios (e.g., 10X or 20X) the way you can with options and futures. (That said, high leverage ratios also require diligent monitoring, since if the price drops even a small amount, you might need to sell a lot. For instance, a 5% price drop with 20X leverage destroys your whole account. The authors of <i>Lifecycle Investing</i> suggest a maximum of 2X leverage, and given that higher leverage amount seem challenging and risky, I'll probably stick to that advice.)</li>
<li>It requires some work to manually watch your leverage amount, pay margin interest, and record all of this on tax returns.</li>
</ul>

<h3>Options</h3>

<i>Lifecycle Investing</i> recommends buying long call options at about half the current price of the security for ~2X leverage. A <a href="http://www.bogleheads.org/forum/viewtopic.php?f=1&t=88487" title="&quot;Lifecycle Investing Leverage Strategy Using LEAPS - How To?&quot;">Bogleheads thread</a> describes more details.

<h4>Arguments for options:</h4>

<ul>
<li>Implied margin interest rates might be competitive for highly liquid options markets, though a friend reports that implied interest rates are unfavorable for thinner markets.</li>
<li>Maybe less manual work than managing a margin account.</li>
</ul>

<h4>Arguments against options:</h4>

<ul>
<li>Need to sell every year or so, which means paying capital-gains taxes that you could avoid from buy-and-hold margin investing. As an example, suppose you sell a <a href="https://en.wikipedia.org/wiki/LEAPS_(finance)">LEAP</a> every 11 months, and say this gives an annual expected return of 7%. Because your capital gains are short-term, you pay, e.g., 28% tax on the gains. That leaves you with a 5% post-tax return.</li>
<li><a href="http://reducing-suffering.org/do-call-options-have-high-expected-returns/" title="&quot;Do Call Options Have High Expected Returns?&quot;">It appears</a> that out-of-the-money call options have very bad expected returns, contrary to theoretical predictions that they should have very good expected returns. Paul Christiano <a href="http://effective-altruism.com/ea/h8/best_way_to_invest_with_leverage/36w" title="&quot;Paul_Christiano comments on Best way to invest with leverage? - Effective Altruism Forum&quot;">seems to suggest</a> that one explanation for this could be that out-of-the-money options are thinly traded. I don't know the answer, but the fact that returns can deviate so sharply from theory at least makes me worried about using options in other contexts. I'd like to learn more about option returns deep in the money (which is the <a href="https://en.wikipedia.org/wiki/Moneyness">moneyness</a> that <i>Lifecycle Investing</i> encourages), but in the meantime, an ordinary margin account seems safer.</li>
</ul>

<h3>Index futures</h3>

Buying futures on, say, the S&P 500 index can multiply your market exposure possibly 10X or 20X. I haven't explored this option enough to comment much on it.

<h4>Arguments for futures:</h4>

<ul>
<li>...</li>
</ul>

<h4>Arguments against futures:</h4>

<ul>
<li>Need to sell every year or so, which means paying capital-gains taxes that you could avoid if you used buy-and-hold margin investing.</li>
<li>May be hard to find a broker that allows futures trading.</li>
<li>As later results suggest, leverage of 10X or more is probably unwise even from a risk-neutral standpoint because it makes it so likely you'll get wiped out in the long run.</li>
</ul>

<h3>Leveraged ETFs</h3>

I wrote more about leveraged ETFs in "<a href="http://reducing-suffering.org/do-leveraged-etfs-have-higher-long-run-returns/">Do Leveraged ETFs Have Higher Long-Run Returns?</a>".

<h4>Arguments for leveraged ETFs:</h4>

<ul>
<li>If leveraged ETFs worked, they would be by far the easiest way to get leverage, since you can buy them in a normal brokerage account without setting up margin or options/futures trading. If you buy and hold, you can also just leave them alone until you want to dispose of them.</li>
</ul>

<h4>Arguments against leveraged ETFs:</h4>

<ul>
<li>They may not work. If you do a web search for {leveraged ETFs}, you'll find that most sources warn that leveraged ETFs are not just risky but actually lose money over the long run due to rebalancing. In "<a href="http://reducing-suffering.org/do-leveraged-etfs-have-higher-long-run-returns/">Do Leveraged ETFs Have Higher Long-Run Returns?</a>", I explored whether this was true. My results were inconclusive, but I leaned toward agreeing that leveraged ETFs probably perform worse in expected returns than conventional ETFs, though the degree of underperformance may not be as much as some claim.</li>
<li>Due to turnover of the assets in the fund, taxes may be greater than with buy-and-hold margin investing. Frequent buying and selling also means transactions costs, bid/ask spreads, etc.</li>
<li>The expense ratios may be ~1% for a service that you could basically replicate on your own with a 2X margin account.</li>
</ul>

<h3>Home mortgage</h3>

A home mortgage is one of the most common form of leveraged investing (with another being college loans).

<h4>Arguments for home mortgages:</h4>

<ul>
<li>Popular and safe method.</li>
</ul>

<h4>Arguments against home mortgages:</h4>

<ul>
<li><a href="http://www.bankrate.com/finance/mortgages/current-interest-rates.aspx" title="'Current Mortgage Interest Rates'">Mortgage interest rates</a> are higher than margin rates from Interactive Brokers.</li>
</ul>

Whether to get a home mortgage depends crucially on whether you want to buy a house in general. There's <a href="https://www.google.com/search?q=rent%20vs.%20buy">much discussion</a> on that question, and following are a few considerations:

<h4>Arguments for buying a house/condo:</h4>

<ul>
<li><a href="http://www.bankrate.com/finance/money-guides/home-sale-capital-gains-1.aspx" title="'Capital gains and your home sale'">Exclusion from</a> $250K ($500K if married) of capital gains when you sell a house.</li>
<li>Mortgage interest is deductible.</li>
<li>You avoid paying taxes on "rent" to yourself, whereas a landlord pays taxes on rent from a tenant. For example, suppose a living space is worth $1000/month intrinsically. If you own it, you're "paying" yourself $1000/month of rent tax-free. If you instead rent it, since you want to get back $1000/month after taxes (assume a 28% tax rate), you have to charge your tenant $1280/month. Hence, the renter pays more. (Thanks to a friend for this point.)</li>
</ul>

<h4>Arguments against buying a house/condo:</h4>

<ul>
<li>Buying and selling is a lot of hassle if you move frequently.</li>
<li>Have to take care of property taxes, repairs, and home improvements yourself.</li>
<li>Real estate is plausibly a worse investment than stocks because people buy real estate partly as a consumption good, i.e., houses have positive "convenience yield". And historically, houses <a href="http://www.cbsnews.com/news/history-says-home-real-estate-is-a-bad-investment/" title="'History says home real estate is a bad investment'">have probably</a> underperformed stocks, though the difference in performance is much smaller when one considers savings from not paying rent.</li>
</ul>

<h2>Tentative conclusion among leverage methods</h2>

Given what I know so far, buying index ETFs on margin looks like it has the least model uncertainty, i.e., is least likely to blow up for unexpected reasons. Margin buying is sometimes advocated even for normal investors, such as <a href="http://www.mathisen.ca/leveraging/leveraging.pdf" title="&quot;Understanding Investment Leverage&quot;">by Manulife Bank of Canada</a>. This increases my confidence that the strategy probably works.

"<a href="http://www.investmentreview.com/files/2009/12/leveraged_portfolios1.pdf">Leveraged Canadian Stock Portfolios: Long-Run Effects on Wealth and Risk</a>" (Figure 2) found that margin investing at 1.8X leverage was optimal in terms of median long-run performance, based on random monthly returns from 1950 to 2001 and assuming monthly rebalancing. <span style="color:red">(check that I got these details correct; reread study)</span>

<h2>IRA to avoid taxes?</h2>

The tax disadvantages of options and futures can be avoided if you're trading in an IRA. However, note that if you can't get a tax deduction for a traditional IRA, then a <a href="http://reducing-suffering.org/advanced-tips-on-personal-finance/#Could_you_also_use_IRAs_for_this_purpose">traditional IRA is a bad deal</a> because you pay income-tax rates both before adding money and when withdrawing it. You can currently avoid this problem using a <a href="http://www.bogleheads.org/wiki/Backdoor_Roth_IRA">backdoor Roth IRA</a>, but it's <a href="http://www.forbes.com/sites/ashleaebeling/2015/02/02/obama-budget-would-prohibit-backdoor-roth-iras/" title="&quot;Obama Budget Would Prohibit Backdoor Roth IRAs&quot;">not clear</a> that this will continue to work forever, and managing one requires nontrivial effort for only ~$5500 of contributions per year. Assuming you save well over ~$5500 per year, you'd still need another leverage method for your other investments.

Another risk with margin investing in IRAs is that if you get a margin call and deposit more funds into the account, you might exceed the IRS limits for the maximum amount you can add to the account per year. The Interactive Brokers Margin Disclosure <a href="https://www.interactivebrokers.com/en/?f=%2Fen%2Faccounts%2FlegalDocuments%2FsemiAnnualDisclosures.php" title="&quot;Semi-Annual Disclosures&quot;">says</a>: "Deposits to the account in excess of [IRS] limits may cause adverse tax consequences, including but not limited to, forfeiture of the tax-advantaged status of the IRA account and/or penalties." That said, this may not be a problem if you always pay margin calls by selling equity rather than depositing more funds.

<h2>Margin simulations</h2>

I created a <a href="https://github.com/Brian-Tomasik/leveraged_investing">Python project</a> to simulate investing on margin. I'll present the results first and then describe its parameters and logic.

<h3>Results</h3>

The Mean, Median, Min, and Max columns of the following table are distributional statistics for the present value of wealth for the different strategies. The E[&radic;(wealth)] column represents expected utility if your utility is &radic;(wealth); this helps incorporate <a href="http://reducing-suffering.org/when-should-altruists-be-financially-risk-averse/" title="&quot;When Should Altruists Be Financially Risk-Averse?&quot;">risk aversion</a>. Lastly, because the final wealth distribution is approximately lognormal, &sigma;<sub>log(wealth)</sub> represents roughly the &sigma; parameter of the lognormal distribution.

<REPLACE>default_results_table</REPLACE>

Since these results scale linearly with the amount of money being invested, the most relevant number is just the percent by which margin investing beats regular: The mean for margin is <REPLACE>margin_better_than_regular_percent</REPLACE>% higher, and the median is <REPLACE>margin_better_than_regular_median_percent</REPLACE>% higher. If your altruistic utility(wealth) = &radic;(wealth), then margin gives <REPLACE>margin_better_than_regular_EU_percent</REPLACE>% higher expected utility.

Following is an example of the distribution of ending wealth with the margin-investing strategy. The graphs for regular and 401k-matched investing have basically the same shape (a roughly lognormal distribution).

<span class="fullwidthimage"><img src="<REPLACE>default_hist_margin</REPLACE>" title="I release this image into the public domain worldwide." /></span>

The next chart shows (real present value) wealth trajectories for the first 20 individual runs of the simulation. Each colored line is one history of the investor under some configuration of market performance and unemployment outcomes.

<span class="fullwidthimage"><img src="<REPLACE>default_wealthtraj</REPLACE>" title="I release this image into the public domain worldwide." /></span>

An investor's margin-to-assets ratio is debt/(total securities value). For example, if you start with $5 and borrow another $5 to buy $10 of an ETF, your margin is $5 and assets are $10, giving a margin-to-assets ratio of .5. The following graph shows the average progression of the simulated investors' margin-to-assets ratios over time. .<REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE> is the target leverage when buying new securities. The decrease over time occurs because the securities tend to increase in value, which creates more assets for the same amount of debt.

<span class="fullwidthimage"><img src="<REPLACE>default_avgMTA</REPLACE>" title="I release this image into the public domain worldwide." /></span>

And this graph shows individual trajectories for the first 20 random investors' margin-to-assets ratios.

<span class="fullwidthimage"><img src="<REPLACE>default_indMTA</REPLACE>" title="I release this image into the public domain worldwide." /></span>

Since the investor sells the biggest capital losses, both for tax-loss harvesting and when she needs money for rebalancing, she accumulates capital losses over time, of which she can deduct $3K per year from income taxes. Following are the first 20 random trajectories of how much capital loss is accumulated over time:

<span class="fullwidthimage"><img src="<REPLACE>default_carrcg</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Input parameters for these results:</h3>

<ul>
<li>invest for <REPLACE>years_until_donate</REPLACE> years before donating</li>
<li>savings are <REPLACE>initial_annual_income_for_investing</REPLACE>/year in the first year, with <REPLACE>annual_real_income_growth_percent</REPLACE>% real annual growth (i.e., after <REPLACE>years_until_donate</REPLACE> years, inflation-adjusted savings are about <REPLACE>yearly_income_at_end_of_investing_period</REPLACE>/year), with a slight penalty the more times the person is laid off</li>
<li>short-term capital-gains tax rate = <REPLACE>short_term_cap_gains_rate</REPLACE></li>
<li>long-term capital-gains tax rate = <REPLACE>long_term_cap_gains_rate</REPLACE></li>
<li>state income-tax rate (whether short-term or long-term gains) = <REPLACE>state_income_tax</REPLACE></li>
<li>monthly probability of being laid off = <REPLACE>monthly_probability_of_layoff</REPLACE></li>
<li>monthly probability of finding work after being laid off = <REPLACE>monthly_probability_find_work_after_laid_off</REPLACE></li>
<li>average annual returns (continuously compounded) of index ETF = <REPLACE>annual_mu_as_percent</REPLACE> (This assumes a return of <a href="http://www.marketwatch.com/story/stocks-future-return-just-56-annualized-2012-09-21" title="&quot;Stocks’ future return: Just 5.6% annualized&quot;">5.6%</a> not continuously compounded, since ln(1 + .056) = .054. This estimate is conservative, since historical returns have been more like ~10% in the USA.)</li>
<li>annual volatility of index ETF = <REPLACE>annual_sigma_as_percent</REPLACE> (see "<a href="http://reducing-suffering.org/do-leveraged-etfs-have-higher-long-run-returns/">Do Leveraged ETFs Have Higher Long-Run Returns?</a>" for how I calculated this; you could also <a href="http://www.indexologyblog.com/2014/02/04/whats-a-normal-vix-level/" title="&quot;What’s a Normal VIX Level?&quot;">look</a> at the <a href="https://en.wikipedia.org/wiki/VIX">VIX index</a>)</li>
<li>"medium black swan" probability = <REPLACE>medium_black_swan_prob</REPLACE></li>
<li>annual volatility for "medium black swan" event = <REPLACE>annual_sigma_for_medium_black_swan</REPLACE></li>
<li>"large black swan" probability = <REPLACE>large_black_swan_prob</REPLACE></li>
<li>annual volatility for "large black swan" event = <REPLACE>annual_sigma_for_large_black_swan</REPLACE></li>
<li>trading days per year = <REPLACE>trading_days_per_year</REPLACE></li>
<li>margin interest rate = <REPLACE>annual_margin_interest_rate_as_percent</REPLACE> (The actual current margin rate on Interactive Brokers <a href="https://www.interactivebrokers.com/en/index.php?f=interest&p=schedule2" title="&quot;Interest Rates Charged to You on Margin Loan Balances&quot;">is</a> 1.12% for account balances of at least $100K and less than $1M. I chose a higher value of <REPLACE>annual_margin_interest_rate_as_percent</REPLACE> to make the calculations more conservative and because current interest rates are extremely low by <a href="http://www.macrotrends.net/1433/historical-libor-rates-chart" title="&quot;Historical LIBOR Rates Chart&quot;">historical standards</a>, which is a trend that may not last for <REPLACE>years_until_donate</REPLACE> more years.)</li>
<li>inflation rate = <REPLACE>inflation_rate_as_percent</REPLACE> (see p. 5 of <a href="http://reducing-suffering.org/wp-content/uploads/2014/09/donatable-money.pdf" title="&quot;How Much Money Could a Person Donate by Having a Conventional Job?&quot;">this piece</a>)</li>
<li>broker-imposed max margin-to-assets ratio in your margin account = <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>% (For simplicity, I'm not distinguishing initial margin vs. maintenance margin.)</li>
<li>voluntarily self-imposed max margin-to-assets ratio in the account = <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% (monthly rebalancing to keep margin below this ratio)</li>
<li>trading fee per dollar of securities bought or sold = $<REPLACE>fee_per_dollar_traded</REPLACE> (this counts both Interactive Brokers trading fees and bid-ask spreads)</li>
<li>number of random iterations = <REPLACE>num_trials</REPLACE></li>
</ul>

<h4>Explanation of "black swan" probabilities</h4>

Simple stock-market models typically use geometric Brownian motion. This is fine for some purposes, but when considering long-term leverage investing, the <a href="https://en.wikipedia.org/wiki/Fat-tailed_distribution">fat tails</a> of actual financial distributions become important. "<a href="http://www.investmentreview.com/files/2009/12/leveraged_portfolios1.pdf">Leveraged Canadian Stock Portfolios: Long-Run Effects on Wealth and Risk</a>" notes that a 4X leverage strategy would have done badly between 1950 and 2001. One reason was <a href="https://en.wikipedia.org/wiki/Black_Monday_(1987)">1987's Black Monday</a>, which would have almost wiped out the whole margin account balance due to a <i>one-day</i> loss of ~23%. (Even end-of-day rebalancing wouldn't have been able to prevent losing almost all account value.) Clearly, "<a href="https://en.wikipedia.org/wiki/Black_swan_theory">black swan</a>" events like these can make a big difference to the final analysis.

The parameters of my normal distribution are &mu; = <REPLACE>annual_mu</REPLACE> and &sigma; = <REPLACE>annual_sigma</REPLACE>. Consider a one-day market movement. Assuming <REPLACE>trading_days_per_year</REPLACE> trading days per year, the expected daily movement is <REPLACE>annual_mu</REPLACE>/<REPLACE>trading_days_per_year</REPLACE> = <REPLACE>annual_mu/trading_days_per_year</REPLACE>, and the standard deviation is <REPLACE>annual_sigma</REPLACE> / &radic;(<REPLACE>trading_days_per_year</REPLACE>) = <REPLACE>annual_sigma/sqrt(trading_days_per_year)</REPLACE>. Since the standard deviation is so much bigger than the mean, let's just focus on the standard deviation and assume a mean of 0.

A loss of 23% in a single day (Black Monday) means multiplying previous prices by (1-.23). Since geometric Brownian motion uses continuous compounding, we should convert this to a continuous rate. We want a change C such that exp(C) = 1-.23, which means C = ln(1-.23) = -.26. This is a daily return that should be able to be sampled from our distribution of daily returns -- the distribution with a mean of (roughly) 0 and a standard deviation of .014. But the <a href="https://en.wikipedia.org/wiki/Standard_score">z-value</a> for a -.26 return is -.26/.014 = -19, which has a probability so small that online normal-distribution calculators can't handle it. Basically, this event should have never happened. But it did once over the 51-year period from 1950 to 2001. This needs to be addressed in the simulations or else they risk ignoring huge risk from black swans.

There are many proposals for modeling fat-tailed distributions in finance. To keep things simple, I chose a finite mixture of normal distributions (see section 6.3 of <a href="http://ect-pigorsch.mee.uni-bonn.de/data/research/papers/Financial_Economics,_Fat-tailed_Distributions.pdf" title="&quot;Financial Economics, Fat-tailed Distributions&quot;">this paper</a>). I estimated the parameters by hand in a quick-and-dirty way as described below, but of course it would help to use more systematically determined parameters, as well as to try other fat-tailed distributions.

Also note that there's a bit of double counting in that for non-black-swan days, I'm using a volatility estimate based on long-run daily-return data, which include some highly volatile periods. Ideally I would exclude the black swans from the data when calculating the non-black-swan mean and variance, but I assume the difference this would make is small, and neglecting to do it just makes the calculations more cautious.

I looked at Wikipedia's "List of largest daily changes in the Dow Jones Industrial Average", focusing on the <a href="https://en.wikipedia.org/wiki/List_of_largest_daily_changes_in_the_Dow_Jones_Industrial_Average#Largest_percentage_changes">largest percentage changes</a>. The dates go back to 1898. The range from 1898 to 2014 is 116 years. Multiplying by <REPLACE>trading_days_per_year</REPLACE> trading days per year, that's roughly 30,000 days. I copied the changes into <a href="https://docs.google.com/spreadsheets/d/1-jeD5_jiHmhGhP-uMoDwI153ZibLBBfGr3Kgn7PgvPo/edit#gid=0" title="&quot;Quick-and-dirty black-swans calculation&quot;">a spreadsheet</a> and computed the equivalent continuous-compounding daily returns.

Except for Black Monday, the returns are relatively uniform, but a normal approximation will do. The standard deviation of the 39 returns excluding Black Monday is about .09, but this estimate is inflated because my data set includes numbers like -.07 and +.07 but no numbers like -.02, 0, or +.02 (i.e., the middle of the distribution is empty). Instead, I estimated the standard deviation by eye. The numbers with the smallest magnitudes in the data set are about -.07 and +.07. Say that's one standard deviation from an assumed mean of 0. Then -.14 and +.14 would be two standard deviations from 0. Observations that extreme or more should occur 5% of the time, and indeed, we see two data points out of the 39 that are roughly .14 in magnitude. Now, the 39 numbers are missing data within one standard deviation of 0. About 68% of observations fall within one standard deviation of the mean. So we can assume that the 39 data points correspond to 100%-68% = 32% of all instances of returns drawn from this distribution. In other words, we can imagine there were 39/.32 = 122 events drawn from this distribution in total, out of 30,000 total days. So the probability that a given daily return will be drawn from this distribution out of the mixture of normals is 122/30,000 = .004. Finally, note that the standard deviation of .07 is for one day, which means the annualized volatility would be .07 * &radic;(<REPLACE>trading_days_per_year</REPLACE>) = 1.1. These are the parameters I used for medium-scale black swans.

Now to handle Black Monday. Suppose that it was 1 standard deviation from the mean of a large-scale black swan distribution. That implies the daily volatility for this distribution is .26, which annualizes to .26 * &radic;(<REPLACE>trading_days_per_year</REPLACE>) = 4.1. It happened once in 30,000 days, so the probability of drawing from this distribution is .00003. To make the calculations more conservative and help account for black-swan changes more extreme than anything we've seen before, increase the probability threefold to .0001. In other words, the probability that a <REPLACE>years_until_donate</REPLACE>-year investing period hits at least one such event is 1-Prob(hit zero of them) = 1-.9999<sup>(<REPLACE>years_until_donate</REPLACE> * <REPLACE>trading_days_per_year</REPLACE>)</sup> = <REPLACE>prob_at_least_1_big_black_swan</REPLACE>.

I implemented the mixture of normal distributions by picking a random floating-point number between 0 and 1. If it was <.0001, I used the extreme black-swan distribution. If it was between .0001 and .0041, I used the medium black-swan distribution. Otherwise I used the default normal distribution.

<h3>Results vs. theory</h3>

To compare the simulation results against theory, it helps to strip away some of the complicating features of the simulation. The following numbers show what happens if unemployment, inflation, taxes, and black swans are ignored (set to 0), and if the investor gets paid on only one occasion -- namely, her first pay period right when the simulation starts:

<REPLACE>uitbf_results_table</REPLACE>

In a geometric Brownian motion framework for stock-price evolution, the final price S(t) of a security S after t years <a href="http://www.columbia.edu/~ks20/FE-Notes/4700-07-Notes-GBM.pdf" title="&quot;Geometric Brownian motion&quot;">is</a> the initial price, S(0), times exp(X(t)), where X(t) is a Brownian motion with annual drift &mu; and variance &sigma;<sup>2</sup>. Since X(t) is normally distributed, S(t)/S(0) = exp(X(t)) is lognormally distributed, i.e., ln(S(t)/S(0)) is normally distributed with mean &mu;t and variance &sigma;<sup>2</sup>t. For a <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">lognormal distribution</a>, the median is exp(&mu;t), and the mean is exp(&mu;t + &sigma;<sup>2</sup>t/2). Hence, the median final value of wealth from investing should be S(0) exp(&mu;t), and the mean final value should be S(0) exp(&mu;t + &sigma;<sup>2</sup>t/2). For more explanation, see <a href="https://books.google.com/books?id=DFJg_3PJ5ToC&pg=PA83&lpg=PA83&dq=%22geometric+brownian+motion%22+median&source=bl&ots=arNDISdxak&sig=wT1rLUBmWkHDqt2EmCBAw5KYOg8&hl=en&sa=X&ei=GFQ-Vb3fMNa1sQSv4YGwAw&ved=0CD0Q6AEwBA#v=onepage&q=%22geometric%20brownian%20motion%22%20median&f=false" title="'Statistics and Finance: An Introduction' by David Ruppert, p. 83">here</a>.

When I reported my numbers in this simulation, I discounted with <a href="https://en.wikipedia.org/wiki/Compound_interest#Continuous_compounding">continuous interest</a> using an interest rate of &mu; = <REPLACE>annual_mu</REPLACE> per year and a time of t = <REPLACE>years_until_donate</REPLACE> years. That is, I multiplied the final amounts by exp(- <REPLACE>annual_mu</REPLACE> * <REPLACE>years_until_donate</REPLACE>). The reason to use continuous interest is that the geometric Brownian motion model assumes it, and since stock prices are compounded <REPLACE>trading_days_per_year</REPLACE> times per year, the return is approximately continuously compounded anyway. As a result of this discounting, we should actually observe that the median of the distribution will be S(0) exp(&mu;t) exp(-&mu;t) = S(0), while the mean should be S(0) exp(&mu;t + &sigma;<sup>2</sup>t/2) exp(-&mu;t) = S(0) exp(&sigma;<sup>2</sup>t/2).

In the simulation, I used t = <REPLACE>years_until_donate</REPLACE> years, &mu; = <REPLACE>annual_mu</REPLACE> per year, &sigma; = <REPLACE>annual_sigma</REPLACE>, and S(0) = <REPLACE>theoretical_median_PV_ignoring_complications</REPLACE>.<!-- There's not actually a single initial price S(0) because the securities are bought over time. However, we can pretend that the investor buys just one big initial security whose price equals the present value of purchases discounted at an interest rate of <REPLACE>annual_mu_as_percent</REPLACE>. An analytic formula for this discounted sum is messy, so I just computed it <a href="https://docs.google.com/spreadsheets/d/1STH-QEMwybDKrouTnNEWeXQXU9VK1SEmq_qNxPCdUTc/edit?usp=sharing">in a spreadsheet</a>. If we ignore periods of unemployment and inflation, the result is that S(0) = <REPLACE>theoretical_median_PV_ignoring_complications</REPLACE>.--> The actual median from the above table, <REPLACE>actual_median_ignoring_complications</REPLACE>, is very close to<span style="color:orange">CHECK THIS MANUALLY</span> the theoretical value, S(0).

The theoretical prediction for the mean of the regular account's present value is S(0) exp(&sigma;<sup>2</sup> * <REPLACE>years_until_donate</REPLACE>/2) = <REPLACE>theoretical_median_PV_ignoring_complications</REPLACE> exp(<REPLACE>annual_sigma</REPLACE><sup>2</sup> * <REPLACE>years_until_donate</REPLACE>/2) = <REPLACE>theoretical_mean_PV_ignoring_complications</REPLACE>. For some reason this is slightly bigger than<span style="color:orange">CHECK THIS MANUALLY</span> the actual mean value of the regular account's present value when I set probability of layoffs and inflation both to zero (<REPLACE>actual_mean_ignoring_complications</REPLACE> in the above table), but it's somewhat close.

Since X(t) = ln(S(t)/S(0)) = ln(S(t)) - ln(S(0)), StdDev[X(t)] = StdDev[ln(S(t))]. In theory, StdDev[X(t)] should be just &sigma; * &radic;(<REPLACE>years_until_donate</REPLACE>) = <REPLACE>annual_sigma</REPLACE> * &radic;(<REPLACE>years_until_donate</REPLACE>) = <REPLACE>annual_sigma * sqrt(years_until_donate)</REPLACE>. In the simulations, I found StdDev[ln(S(t))] = &sigma;<sub>log(wealth)</sub> = <REPLACE>actual_sigma_of_log_wealth</REPLACE> for regular investing, which is again pretty close.<span style="color:orange">CHECK THIS MANUALLY</span>

The probability of margin outperforming regular investing in the above table is discouragingly low: <REPLACE>actual_percent_times_margin_is_better</REPLACE>%. Based on other variants I ran, I tracked this low performance down to at least three factors, in rough order of importance:
<ol>
<li>Rebalancing monthly dramatically reduces the chance that margin beats regular investing.</li>
<li>A 15-year time horizon for investing has a lower rate of margin beating regular investing than a 30-year time horizon.</li>
<li>Investing a single amount of cash one time has a lower rate of margin beating regular investing than investing many regular salary payments.</li>
</ol>

If we take the same settings in the results table immediately above but instead don't rebalance monthly, the probability of margin outperforming regular investing rises<span style="color:orange">CHECK THIS MANUALLY</span> to <REPLACE>uitbfdontreb_percent_margin_better</REPLACE>%, and if we also let the investor earn paychecks every month rather than only in the first month, the probability of margin outperforming regular investing rises further<span style="color:orange">CHECK THIS MANUALLY</span> to <REPLACE>uitbdontreb_percent_margin_better</REPLACE>%. This last value is closest<span style="color:orange">CHECK THIS MANUALLY</span> to a quick-and-dirty theoretical calculation of what we'd expect the probability to be of margin investing outperforming regular, as discussed in the next paragraph.

"<a href="http://www.mathisen.ca/leveraging/leveraging.pdf">Understanding Investment Leverage</a>" notes that margin performs better when the average stock/ETF returns exceed a "break-even" threshold. Assuming that capital-gains taxes and tax deductions aren't especially relevant, the break-even threshold should roughly be the margin interest rate -- call it r. In other words, the probability that margin beats non-margin for a given dollar invested is roughly the probability that the t-year returns of investing in the market beat the t-year accumulation of interest at rate r. Let X(t) be the random variable representing the accumulated t-year market return, and let Z be a standard-normal random variable. Then
<blockquote>
Prob[&nbsp;margin beats regular&nbsp;] &asymp; Prob[&nbsp;investments exceed break-even threshold&nbsp;] = Prob[&nbsp;exp(X(t)) > exp(rt)&nbsp;] = Prob[&nbsp;X(t) > rt&nbsp;] = Prob[&nbsp;&mu;t + Z&sigma;&radic;(t) > rt&nbsp;] = Prob[&nbsp;Z&sigma;&radic;(t) > (r-&mu;)t&nbsp;] = Prob[&nbsp;Z > ( (r-&mu;)/&sigma; ) &radic;(t)&nbsp;] = 1 - Prob[&nbsp;Z &le; ( (r-&mu;)/&sigma; ) &radic;(t)&nbsp;&nbsp;] = 1 - Prob[&nbsp;Z &le; ( (<REPLACE>annual_margin_interest_rate</REPLACE>-<REPLACE>annual_mu</REPLACE>)/<REPLACE>annual_sigma</REPLACE> ) &radic;(<REPLACE>years_until_donate</REPLACE>)&nbsp;&nbsp;] = 1 - Prob[&nbsp;Z &le; <REPLACE>Z_value_threshold</REPLACE>&nbsp;] <a href="https://surfstat.anu.edu.au/surfstat-home/tables/normal.php" title="&quot;SurfStat standard normal calculator&quot;">= 1 - <REPLACE>prob_Z_leq_threshold</REPLACE></a> = <REPLACE>prob_Z_gt_threshold</REPLACE>.
</blockquote>

<h3>How the simulation works</h3>

I compare investing in a regular brokerage account vs. buying on margin. In both cases, I assume you only buy a single index ETF, such as <a href="http://finance.yahoo.com/q?s=SPY">SPY</a>.((Buying an index fund instead of individual stocks diversifies investments. Diversification is suggested by "<a href="http://www.mathisen.ca/leveraging/leveraging.pdf">Understanding Investment Leverage</a>", p. 8, item #5. That said, I would guess that buying some individual stocks would be almost as diversified, so that seems like a viable alternative to an index ETF.)) Its price updates every weekday. You get paid every month and use that new income for investing. If you have a margin account, you also pay interest on it every month, on your pay day.

Most of the time you're earning money, but occasionally, at random, you might get laid off. I incorporated this aspect of the simulation to make calculations more conservative. The idea came from <a href="http://www.michaeljamesonmoney.com/2012/03/lifecycle-investing-leveraged-strategy.html" title="&quot;Lifecycle Investing – a Leveraged Strategy&quot;">this post</a>. In fact, that post suggests that layoffs are more likely during market downturns, but for simplicity, I made layoffs just random.

If you use a regular brokerage account, then every month when you're not laid off, you just use your new income to buy more of the index ETF. End of story.

If you use a margin account, your actions are a bit more complex. With the money that you earn when you're not laid off:
<ol>
<li>First you pay whatever interest is due on your margin borrowing from prior months, using the new savings that you're depositing. (If you don't have enough income this month to cover interest, you sell some of your investments to pay the interest. In the simulations I've run, this only happens when you get laid off.)</li>
<li>You check the margin-to-assets ratio in your margin account. If it's below <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% (i.e., <REPLACE>initial_personal_max_margin_to_assets_relative_to_broker_max_as_percent</REPLACE>% of the broker-required <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>% ratio), you leave the account alone. If the margin-to-assets ratio is above <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>%, you first pay for it with that month's paycheck, and if that's not enough, you sell some investments to bring the ratio back down to <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>%. It may be best not to do this too much because selling investments can incur capital-gains tax.((Another possible reason why frequent rebalancing might be bad is if it produces similar behavior as happens with leveraged ETFs, though I haven't figured out the math of whether this is actually true.)) That said, one of two cases where your margin-to-assets ratio gets above <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% is when the market underperforms the interest rate, which means you tend to have capital losses and so get some tax benefit from selling. The program chooses the most tax-advantaged lots of your portfolio to sell, based on which, if sold, would trigger the least capital-gains tax (which includes the biggest negative capital-gains tax if you have losses). The other case where your margin-to-assets ratio might get too big is if you're laid off for more than a brief period, so that interest payments pile up.</li>
<li>If you have any monthly income left over after the previous steps, use it to buy new shares of the index ETF at a margin-to-assets ratio of <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>%, i.e., for every $100 of shares you buy directly, you also loan $<REPLACE>example_loan_to_take_for_100_of_shares_equity</REPLACE> to buy more shares on margin. This is because <REPLACE>example_loan_to_take_for_100_of_shares_equity</REPLACE> / (<REPLACE>example_loan_to_take_for_100_of_shares_equity</REPLACE> + 100) = .<REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>.</li>
<li>If your margin-to-assets ratio is below our target (<REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>%), then buy new securities to reach your target. In order to avoid incurring transactions costs on trivially small equity purchases, you only buy new ETF shares for rebalancing if you can buy at least $<REPLACE>min_additional_purchase_amount</REPLACE> of such shares at once.</li>
</ol>
As you move toward your target date for donating the securities, you ramp down leverage to make sure you'll have enough equity to pay off your debts. This ramp-down basically doesn't affect the default scenario of 2X leverage, but for higher leverage amounts, it forces you to drop down to being within 3X leverage when there are at most 10 years left and within 2X leverage when there are at most 5 years left.

You maintain a self-imposed maximum margin-to-assets ratio of <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% to give some breathing room relative to the broker-imposed maximum margin-to-assets ratio of <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>%. In the simulation, the broker checks the margin-to-assets ratio every weekday and, if it's above <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>%, sells securities randomly to keep the ratio within bounds. But this is bad for you, since it leads to unpredictable selling behavior. For instance, maybe the broker sells securities with high, short-term capital gains rather than those with capital losses. It's better if you can personally keep margin-to-assets ratios in check by selling securities manually as needed. But you don't want to manage the account daily, so you monthly keep the margin-to-assets ratio less than <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>%, on the assumption that the ratio won't move above <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>% within the next month. Adopting this policy reduces manual maintenance work. It's much easier to check a margin account 12 times a year than <REPLACE>trading_days_per_year</REPLACE> times a year, and the lost leverage by maintaining a maximum <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% ratio instead of <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>% isn't that big.

Different variations of a margin strategy sell securities at different rates. The more leveraged you are, the more likely you are to sell securities at a loss to meet margin requirements. This means some strategies get more tax benefit from capital losses than others. To help put the strategies on somewhat more even footing, I added tax-loss harvesting, which is done by both margin and regular investors every December: You sell all securities with losses and use the money to buy the sold ETF back. (In real life, you'd have to wait a month before buying back to avoid a <a href="https://en.wikipedia.org/wiki/Wash_sale">wash sale</a>, but in the simulation you buy it back immediately for simplicity.)

Your capital-gains taxes accumulate from selling, both for tax-loss harvesting and for rebalancing your margin account as needed. Every March 1, you pay off any taxes owed, if necessary by selling some securities. However, almost uniformly you have net capital losses, because basically the only times you might sell securities at a capital gain are (1) if the broker liquidates them to keep you within the <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>% margin limit or (2) if you're unemployed for a while and have to sell ETF shares with gains.

In rare cases, such as when a big negative black swan occurs, highly leveraged accounts might go bankrupt due to having more debt than remaining assets. In this case, I set the ending value of the margin account to 0 to be conservative, even though in practice, someone who went bankrupt could presumably continue earning and investing somewhat in subsequent years. Note that only margin accounts can go bankrupt.

When you're ready to donate the securities, you use your investments to pay off any remaining margin loans. Because you're donating the final securities, there's no capital-gains tax on them. If instead you use this calculator for personal investing (say, for retirement) rather than investing prior to donating, then you'd need to account for capital-gains tax upon selling. (In that case, it's less bad to pay capital-gains taxes early because doing so increases your cost basis, though it's still better to delay tax payments to later years because of the <a href="https://en.wikipedia.org/wiki/Time_value_of_money">time value of money</a>.)

The final comparison among the strategies as presented in the results is the real present value of accumulated savings, i.e., the value after <REPLACE>years_until_donate</REPLACE> years times (1 + inflation_rate)<sup>-<REPLACE>years_until_donate</REPLACE></sup> to adjust for inflation and then times exp(-avg_ETF_returns * <REPLACE>years_until_donate</REPLACE>)</sup> to make it a present value. Looking at real present values is more informative than nominal future values because we have a better sense of what the value of a dollar is right now than what the value of a dollar will be in <REPLACE>years_until_donate</REPLACE> years.

<h2>401k matching beats leverage</h2>

<i>Lifecycle Investing</i> points out that most 401k plans don't allow leverage. But many employers match 401k contributions at a 2X or 1.5X rate. The book says you should always max out matching 401k contributions before investing with leverage on your own.

To test this out, I added to my simulation an investor who just contributed to a regular, non-margin brokerage account but was able to put in <REPLACE>match_percent_from_401k</REPLACE>% more than normal. For instance, if regular investors contributed $2500/month, this investor contributed $3750/month. In practice, employers typically cap the amount of 401k contributions that can be matched per pay period at a relatively low level, but I ignored that point so that I could compare the 401k investor on equal footing with the other investors, and then if I saw the 401k investor beating the others, it would follow that any given dollar of employer-matched 401k investing would beat any given dollar of non-employer-matched margin investing, which would imply that you should max out employer matching first and only then use margin investing for the remaining income.

I did indeed find that a <REPLACE>match_percent_from_401k</REPLACE>%-matched 401k beat either other type of investing. This was shown in the results table in the previous section. Before I added tax logic to my simulation, the 401k-matching strategy returned <i>exactly</i> 1.5 times the regular investing strategy, which it should given that I compared the investments with respect to the same random stock-market returns.

In reality, the amount you can contribute to a <REPLACE>match_percent_from_401k</REPLACE>% matched 401k is more than <REPLACE>match_percent_from_401k</REPLACE>% of what you can invest on margin on your own because a 401k is pre-tax, while margin investing uses post-tax dollars. However, you'll later have to pay taxes on your 401k withdrawals, so if your tax rate is the same now vs. in retirement, the tax-deferred nature of 401k contributions doesn't matter, since the amount at the end is (1-income_tax_rate) times (the pre-tax income that you put in plus equity appreciation). That said, if (as is common) you expect to have a lower marginal tax rate in retirement, this makes 401k contributing look even more favorable.

<h3>What about non-matched 401k?</h3>

The annual contribution limit for a 401k <a href="http://www.irs.gov/uac/Newsroom/IRS-Announces-2015-Pension-Plan-Limitations-1" title="&quot;IRS Announces 2015 Pension Plan Limitations; Taxpayers May Contribute up to $18,000 to their 401(k) plans in 2015&quot;">is $18K</a>, which is probably higher than the amount that your employer matches. Should you only contribute to your 401k the amount your employer matches and invest the remainder in an after-tax margin account using leverage? Or should you contribute all $18K to the 401k and let the money grow tax-free there? The choice isn't obvious, and following are some considerations in favor of each option.

<h4>Reasons favoring 401k:</h4>

<ul>
<li>If you expect to have a lot of income during retirement, you'd presumably pay at least 15% taxes on capital gains outside a 401k. In the default margin-investing scenario above, margin investing beat regular investing by ~<REPLACE>margin_better_than_regular_percent</REPLACE>% in expectation <i>with higher risk</i>. So if you plan to spend the savings on yourself, if you use a margin account, your savings would be only (1 + .<REPLACE>margin_better_than_regular_percent</REPLACE>)(1 - <REPLACE>long_term_cap_gains_rate</REPLACE>) = <REPLACE>(1+margin_advantage)(1-long_term_cap_gains)</REPLACE> as much as if you had put them in a non-leveraged 401k account that doesn't incur capital-gains taxes.</li>
<li>If you expect to be in a lower income bracket during retirement (say 15% instead of 28%), then contributing to a 401k allows you to pay less income tax in addition to no capital-gains tax.</li>
</ul>

<h4>Reasons favoring margin investing:</h4>

<ul>
<li>Plausibly you can get enough retirement savings just by the amount you contribute to your 401k for employer matching. In this case, you could donate your margin-invested securities and not pay capital-gains tax on them. If so, the only advantage of a 401k is that you might be in a lower income bracket during retirement.</li>
<li>Contributing to a 401k locks the money in your retirement account for several decades. What if you want to donate it sooner? What if the financial system as a whole changes radically during those years, such that your 401k money becomes less valuable?</li>
<li>Currently, people in the 15% income bracket or below pay no capital-gains tax. So if your income during retirement was low enough, you might be able to spend your margin-invested savings on yourself without paying capital-gains tax. However, it might be hard to keep your income during retirement low enough to be sure you won't pay capital-gains taxes. Likewise, it's quite possible that Congress will change capital-gains rates by the time of your retirement, so that even people in the 15% income bracket will pay capital-gains taxes.</li>
<li>As we saw above, margin investing returns an expected <REPLACE>margin_better_than_regular_percent</REPLACE>% more than regular investing, according to the default simulation parameters. On the other hand, having some additional investments in a non-leveraged 401k could reduce your risk of a financial blow-up.</li>
</ul>

<h2>Donor-advised fund vs. leverage</h2>

As with a 401k, I don't think you can use leverage in a donor-advised fund (DAF). So should you forgo the DAF in order to use margin? The answer may depend on your situation.

<h3>How much is a DAF worth?</h3>

The advantage of a DAF is that you can deduct a donation from your income taxes immediately rather than when you eventually pick a charity to receive the funds.

<h4>If you donate small amounts</h4>

For small-time donors, deducting a donation now vs. later may not be crucial. Because of the time value of money, a given amount of tax deduction now is worth more than the same amount taken later. But if you wait until later, your funds to donate should in general have grown in value, so the value of deduction later will actually be larger, which roughly cancels the argument from time value of money for donating sooner. So the value of DAF donating is roughly zero for these donors, ignoring other confounding factors such as that donating to a DAF may help maintain your commitment to donating but may also lock you in to donating to just US-based 501(c)(3)'s rather than other organizations.

<h4>If you donate a lot</h4>

In contrast, donating to a DAF is quite important for big-time donors who plan to give at least 50% of adjusted gross (AGI) income each year. This is because donating every year helps these donors take full advantage of deductions given that at most 50% of a person's AGI can be deducted for charity contributions in a single year. Charitable deductions above 50% carry forward to future years, but if you consistently donate above 50% <i>every year</i>, you'll never get a chance to take all your accumulated charity deductions. Hence, deducting charity donations each year that you earn becomes important.

If a donor in this situation doesn't have a charity picked out yet and would lose the year's charitable deductions if she didn't donate to a DAF, then donating to a DAF saves taxes. Say the donor is deep in the 28% marginal income bracket. By donating some amount $X (assume $X is below the 50%-of-AGI limit), she gets $.28X back on taxes (and that refund is untaxed), so it's as if she multiplied her money by 1.28. In other words, donating to a DAF is similar to donating to a 401k that matches 28% rather than <REPLACE>match_percent_from_401k</REPLACE>%.

Whether this is better than leverage depends on the donor's risk tolerance and the advantage of leverage. For a risk-neutral investor, the DAF is better only if the expected wealth of using margin is less than 28% higher than not. For a risk-averse investor with utility(wealth) = &radic;(wealth), the DAF is better unless the expected-utility value in the above table is more than &radic;(1.28) times better for margin than non-margin (which it isn't). The reason for the &radic;(1.28) threshold is that donating to a DAF multiplies wealth by 1.28 with certainty, which means it multiplies expected &radic;(wealth) by &radic;(1.28).

<h3>Should you invest at all?</h3>

There's <a href="http://www.effective-altruism.com/ea/4e/giving_now_vs_later_a_summary/" title="'Giving now vs. later: a summary' by Julia Wise">much</a> <a href="http://effective-altruism.com/ea/4e/giving_now_vs_later_a_summary/3bq" title="'Brian_Tomasik comments on Giving now vs. later: a summary - Effective Altruism Forum'">discussion</a> of the question of whether to donate now or later.

For my personal situation, I think the optimal strategy is to donate some amount now toward projects that are either very underfunded or that should be done sooner rather than later. For instance, the <a href="http://foundational-research.org/">Foundational Research Institute</a> is more urgent than a regular charity because its conclusions will help me direct the remainder of my donations. For the rest of my donations, I'd rather wait at least a decade, because I'm continuing to learn a lot, and my conclusions may change with new insights.

This explains why the altruist in my simulations only invests ~<REPLACE>initial_annual_income_for_investing</REPLACE>/year rather than a larger amount. It's because she's donating much of the remainder, either to charities directly or at least to a DAF to max out her 50%-of-AGI limit.

<h2>Optimal leverage</h2>

<h3>Literature</h3>

In practice, margin leverage is not unlimited. But suppose it were. What would be the best amount of leverage to use?

One theoretical perspective on the question comes from the <a href="https://en.wikipedia.org/wiki/Kelly_criterion">Kelly criterion</a> applied to the stock market. As <a href="https://www.math.washington.edu/~morrow/336_10/papers/jane.pdf" title="&quot;Betting with the Kelly Criterion&quot;">this summary</a> explains (p. 5), the optimal betting fraction is approximately (&mu;-r)/&sigma;<sup>2</sup>, where &mu; and &sigma; are as defined above, and r is the interest rate (for investing or borrowing). Using the parameter values for my default simulation, this optimal fraction is (<REPLACE>annual_mu</REPLACE>-<REPLACE>annual_margin_interest_rate</REPLACE>)/<REPLACE>annual_sigma</REPLACE><sup>2</sup> = <REPLACE>Kelly_ratio_as_percent</REPLACE>%. Hence, this suggests using no leverage and splitting 50:50<span style="color:orange">CHECK THIS MANUALLY</span> between stocks and bonds! This isn't consistent with my results or with conventional wisdom. Of course, the parameters I used in this Kelly-criterion calculation were quite conservative. Based on historical US data, many people would probably set &mu; at more like .1, in which case the optimal betting fraction would be 1.45, i.e., almost 1.5X leverage.

"<a href="http://www.investmentreview.com/files/2009/12/leveraged_portfolios1.pdf">Leveraged Canadian Stock Portfolios: Long-Run Effects on Wealth and Risk</a>" (2003) presents a simulation of leveraged investing based on actual historical returns between 1950 and 2001. The authors found that the optimal amount of leverage over this period would have been about 1.5X (rebalancing monthly). 4X leverage left almost no ending wealth, although this was partly because the simulation assumed monthly rebalancing, whereas daily rebalancing can reduce the risk of wipeout. The paper's Figure 1 shows an inverted U curve for the ending wealth of an investor from 1950 to 2001 as a function of how much leverage she used, between 1X and 4X.

"<a href="http://www.fsa.ulaval.ca/nfa2003/papiers/Craig%20Wilson.pdf">Leveraged Stock Portfolios over Long Holding Periods: A Continuous Time Model</a>" (2003) found optimal leverage of 2.41X based on historical parameters. Its equation (20) on p. 7 is the same as the Kelly formula above.

"<a href="https://www.questia.com/library/journal/1P3-977793091/wealth-and-risk-from-leveraged-stock-portfolios">Wealth and Risk from Leveraged Stock Portfolios</a>" (2002) found optimal leverage of 1.7X assuming borrowing at 2% above Treasury bills. The authors note: "A modest amount of leverage enhances the performance of stock portfolios in the long run. However, higher amounts of leverage produce dramatic declines in long-run wealth."

<h3>My results</h3>

Following is my version of a graph((In general, I use standard error for error bars because then if two error bars don't overlap, the difference is roughly statistically significant. Since the quantities in this graph are ratios (sample mean #1 divided by sample mean #2), I used a formula for propagation of uncertainty when dividing two uncertain quantities. The full formula <a href="https://en.wikipedia.org/wiki/Propagation_of_uncertainty#Example_formulas">according to Wikipedia</a> is
<blockquote>
if f = A/B then &sigma;<sub>f</sub> is roughly |f| &radic;[ (&sigma;<sub>A</sub>/A)<sup>2</sup> + (&sigma;<sub>B</sub>/B)<sup>2</sup> - 2&sigma;<sub>AB</sub>/AB ].
</blockquote>
For simplicity, I omitted the correlation component of the equation (the -2&sigma;<sub>AB</sub>/AB part), which only makes my error bars conservatively big given that the sample-mean margin investment performance has a high correlation with the sample-mean regular investment performance, since the sample means for both quantities will be too high when particularly good stock returns are sampled and too low when particularly bad returns are sampled.

Unfortunately, it looks like the error bars in this graph are actually too small. This is because the averages for some leverage amounts clearly deviate from the trend of the curve, and their error bars don't even overlap with the error bars of neighboring points on the curve. But the curve should be continuous in theory. Hence, the error bars must be too small.)) for finding optimal leverage. It uses the default configuration, which means the investor buys new securities at <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% of 2X leverage and rebalances monthly to remain roughly that amount leveraged throughout the simulation. Higher leverage amounts ramp down leverage toward the end of the investing period. As in the tables above, I took utility(wealth) = &radic;(wealth). Each data point came from <REPLACE>num_trials</REPLACE> trials.

<span class="fullwidthimage"><img src="<REPLACE>default_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

The peaks of the curves seem to be around 2.5X leverage<span style="color:orange">CHECK THIS MANUALLY</span>, though sticking to 2X<span style="color:orange">CHECK THIS MANUALLY</span> leverage seems like a safe policy to avoid falling off the steep cliff. :)

<h2>Different margin investing policies</h2>

<h3>Don't taper off leverage near end of investing period</h3>

<REPLACE>donttaper_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>donttaper_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Don't rebalance up to 2X leverage monthly</h3>

In my default simulation configuration, the investor may become less leveraged over time because she only takes 2X leverage on new equity purchases. If the market rises, her leverage becomes less than 2X due to higher equity without correspondingly higher debt. By default I avoided rebalancing to increase leverage in these cases out of concern that too much rebalancing would be harmful, along the lines of what we see with leveraged ETFs. But I wanted to try a variant where this kind of rebalancing was done monthly if the margin-to-equity ratio fell below <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% (the investor's personal not-quite-2X leverage target). In order to avoid incurring transactions costs on trivially small equity purchases, the investor only buys new ETF shares for rebalancing if she can buy at least $<REPLACE>min_additional_purchase_amount</REPLACE> of such shares at once.

<REPLACE>dontreb_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>dontreb_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

Remember that <span style="color:red">"2.5X leverage" isn't really 2.5X</span> because in this setting, the investor only rebalances when asset prices fall, not when they rise, so the investor is actually not fully leveraged much of the time. Therefore, don't conclude that you should use 2.5X leverage for a strategy that <i>does</i> rebalance!

TEST THIS: Oddly, the results depend very sensitively on what might seem a trivial parameter: whether, when Interactive Brokers liquidates shares in the investor's account to stay within margin limits, they liquidate random shares or the shares with the biggest capital losses. If Interactive Brokers liquidates random shares, they may leave the investor with big capital gains that will be taxed. If Interactive Brokers liquidates the shares with the biggest losses, they typically leave the investor with net capital losses, of which $3K/year can be deducted from income taxes.

The margin-to-assets ratios for this variation tend to decline more with time as asset prices grow, since the investor isn't actively rebalancing back up toward target leverage. Here's a graph of that for 2X leverage:

<span class="fullwidthimage"><img src="<REPLACE>dontreb_indMTA</REPLACE>" title="I release this image into the public domain worldwide." /></span>

Also, there are many fewer accumulated capital losses because if leverage is less than 2X, there's much less selling of securities to meet margin requirements:

<span class="fullwidthimage"><img src="<REPLACE>dontreb_carrcg</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Don't rebalance up to 2X leverage monthly and don't taper off leverage toward end</h3>

<REPLACE>dontrebtaper_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>dontrebtaper_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Don't rebalance up to 2X leverage monthly and pay principal throughout</h3>

This is the most conservative strategy. Leverage can be made less risky if, instead of keeping your loans around until the end of the investing period, you pay them off over time as if you were paying off a home mortgage. Doing this means you're less leveraged at later times, as this graph shows (for the 2X leverage configuration):

<span class="fullwidthimage"><img src="<REPLACE>princthru_indMTA</REPLACE>" title="I release this image into the public domain worldwide." /></span>

Obviously this configuration is incompatible with the default policy of rebalancing back up to 2X leverage, since paying off principal throughout reduces the margin-to-assets ratio over time, while a policy of rebalancing to increase leverage would undo that.

For this variation, I used a regular <a href="https://en.wikipedia.org/wiki/Annuity_(finance_theory)#Annuity-due">annuity</a> mortgage calculation to pay off principal such that the investor's margin loans would be fully paid off on the exact date when the investor donates the securities.((This approach of paying off principal over time is suggested in "<a href="http://www.mathisen.ca/leveraging/leveraging.pdf">Understanding Investment Leverage</a>", p. 8, item #6.)) (If the investor doesn't have enough income one month to pay off principal, she sells some of her investments to pay for it. In the simulations I've run, this only happens during months when she's laid off.)

We can see from the results table for this method that it's more certain to outperform non-margin investing due to its safety, though it also has less of an edge over non-margin investing.

<REPLACE>princthru_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>princthru_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Best policy?</h3>

look at graphs...


<h2>Parameter sensitivity analysis</h2>

This section explores how the results change with different parameter configurations, to help ensure that the findings are not specific to the particular input assumptions I made.

<h3>Assume that Interactive Brokers margin liquidations sell the most tax-advantaged lots first</h3>

In the default simulation, I assumed that if you exceed your broker's margin threshold, your broker sells securities randomly to pay off debts, without consideration of whether securities will incur positive capital-gains taxes. This variant instead assumes that your broker liquidates the securities with the biggest percent losses first.

<REPLACE>FO_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>FO_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

Here are some accumulated capital losses for the 2X-leverage version of this configuration:

<span class="fullwidthimage"><img src="<REPLACE>FO_carrcg</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Use VIX daily volatilities</h3>

The default simulation assumes a constant annualized volatility of &sigma; = <REPLACE>annual_sigma</REPLACE>. In the real world, volatility swings a lot and sometimes reaches very high levels. How much does this affect the results? To see, I downloaded <a href="http://www.cboe.com/publish/scheduledtask/mktdata/datahouse/vixcurrent.csv">VIX data</a> from <a href="http://www.cboe.com/micro/vix/historical.aspx" title="&quot;VIX Options and Futures Historical Data&quot;">CBOE</a> between 2004 and 2015. This gave a list of volatility numbers. In the simulation, I let the daily volatility values run through that list in order, and if the simulation had more days than the VIX data, I cycled through from the start again. The VIX data include the crash of 2008 (see <a href="http://avondaleam.com/how-good-is-the-vix-at-forecasting-future-volatility/" title="&quot;How Good is the VIX at Forecasting Future Volatility?&quot;">here</a> for a chart of the data), so probably this data set overstates volatility relative to typical market conditions.

<REPLACE>VIX_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>VIX_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Invest for 5 years instead of 15</h3>

"<a href="http://www.mathisen.ca/leveraging/leveraging.pdf">Understanding Investment Leverage</a>" (p. 8) notes that leverage is less risky over longer time horizons. Hence, we'd expect to see higher risk measures for investing over 5 years vs. <REPLACE>years_until_donate</REPLACE> years. That's indeed what we see below.<span style="color:orange">CHECK THIS MANUALLY</span>

<REPLACE>yrs5_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>yrs5_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Invest for 30 years instead of 15</h3>

<REPLACE>yrs30_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>yrs30_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>&mu; = .07</h3>

<REPLACE>mu07_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>mu07_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

These results are lower than normal because I'm discounting by exp(-&mu; t), so a higher &mu; implies more discounting. The undiscounted values should actually be higher than for other variants because of higher &mu;.

<h3>&sigma; = .40</h3>

<REPLACE>sig4_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>sig4_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>&sigma; = 0, no black swans, no unemployment</h3>

This variant is mainly useful for debugging. It helps show what effect stock-market and unemployment randomness have on the results.

<REPLACE>sig0_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>sig0_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h3>Margin interest rate = 1.5%</h3>

The actual margin interest rate for Interactive Brokers in 2015 <a href="https://www.interactivebrokers.com/en/index.php?f=interest&p=schedule2" title="&quot;Interest Rates Charged to You on Margin Loan Balances&quot;">is around 1.5%</a>, so I wanted to test this parameter setting rather than just the default, more cautious value of <REPLACE>annual_margin_interest_rate_as_percent</REPLACE>. With &mu; = <REPLACE>annual_mu_as_percent</REPLACE>, this implies an <a href="https://en.wikipedia.org/wiki/Equity_premium_puzzle">equity premium</a> of ~<REPLACE>equity_premium_as_percent</REPLACE>%.

<REPLACE>int_r015_results_table</REPLACE>

<span class="fullwidthimage"><img src="<REPLACE>int_r015_optimal_leverage_graph</REPLACE>" title="I release this image into the public domain worldwide." /></span>

<h2>Further features that could be implemented</h2>

The simulation could be made more robust by letting some parameters that are now constants vary, such as the margin <a href="https://en.wikipedia.org/wiki/Short-rate_model#Particular_short-rate_models">interest rate</a>, inflation, the investor's income growth rate, and tax rates. Probably at least some of these should be modeled as <a href="https://en.wikipedia.org/wiki/Mean_reversion_(finance)">mean-reverting processes</a>. I didn't add variation in these parameters to the simulation because I doubted they would make much difference to the trends.

I didn't include tax deductions from margin interest in the simulation because that would have complicated the code. I also didn't think it would make a big difference, because margin interest is only deductible to offset net investment income, and at least when using a buy-and-hold strategy, there's rarely positive net investment income, since most securities sales only happen when there's a capital loss that forces rebalancing to pay down debt. (One exception is when the investor becomes unemployed during periods of capital gains and needs to sell securities just to pay interest on margin loans, assuming she doesn't have lots of accumulated capital losses to offset the gains.)

The simulation also doesn't include the impact of dividends, which incur income taxes annually. For instance, suppose the investor has $500K of securities paying 2% annual dividends. That's $10K of extra taxable income per year, which at a 28% tax rate implies almost $3K of extra taxes. (If the donor is maxing out charitable donations during the year, the tax cost <a href="http://reducing-suffering.org/advanced-tips-on-personal-finance/#Marginal_tax_rate_halved_when_you_donate_a_lot">is only half</a> as big.) The difference between the impact of these tax payments for regular vs. margin investing is probably fairly small.

Finally, my simulation may be overly conservative when it comes to black-swan risks. My code assumes that a margin broker can only rebalance to restore margin ratios at the end of a trading day. This means that a 5X-leveraged investor going through 1987's Black Monday would have been completely wiped out. In practice, I think Interactive Brokers would liquidate positions throughout the day if there were big losses, in which case a 5X-leveraged investor wouldn't have been completely bankrupted by Black Monday. The simulation could be extended to handle this by making the time granularity some fraction of a day rather than a full day. This would require some updates to parameters for number of days per year, trading days per year, tax dates, etc. It would also make the simulation slower in proportion to the increased number of time steps. Since it's generally not possible in the real world to use 5X margin leverage anyway, it's maybe not crucial to incorporate intra-day rebalancing to the calculations. Still, doing so might affect results for lower leverage amounts too. I wonder with what frequency Interactive Brokers would have done rebalancing on a Black Monday. With a drop like the <a href="https://en.wikipedia.org/wiki/2010_Flash_Crash">2010 Flash Crash</a>, occuring within minutes, there plausibly wouldn't have been enough time for Interactive Brokers to liquidate, but on the other hand, the crash mostly reversed itself within minutes, so it probably also wouldn't have triggered margin calls or destroyed a highly leveraged margin investor.

<h2>Warnings</h2>

<h3>General</h3>

Margin investing seems relatively complex, so I plan to try it out with small amounts of money at first, until I learn the mechanics and tax implications.

If you don't have the time to learn the details of margin investing, it's probably best to shy away from it.

<h3>About Interactive Brokers</h3>

The Interactive Brokers (IB) Customer Agreement warns that IB may liquidate positions if margin exceeds limits without issuing a margin call, i.e., without giving you a chance to add more money. IB reserves the right to liquidate whichever securities they want without telling you. This seems bad in part because IB might(??) liquidate short-term rather than long-term assets, thereby increasing the capital-gains taxes you'll pay. To avoid this, I would probably manually maintain a margin amount less than the limit so that I'm the one who manually does rebalancing when necessary. For instance, if IB allows at most a <REPLACE>broker_max_margin_to_assets_ratio_as_percent</REPLACE>% margin-to-assets ratio, I might manually impose a cap of <REPLACE>volunary_max_margin_to_assets_as_percent</REPLACE>% on my own.

IB's Customer Agreement also says: "Customer acknowledges Customer's responsibility for knowing the terms of any securities, options, warrants or other products in Customer's account, including upcoming corporate actions (e.g., tender offers, reorganizations, stock splits, etc.). IB has no obligation to notify Customer of deadlines or required actions or dates of meetings, nor is IB obligated to take any action without specific written instructions sent by Customer to IB electronically through the IB website." Presumably this is less of a problem if you're investing in index ETFs, but if you invest in individual stocks, watch out! I own individual stocks in my regular brokerage account, and I would guess that ~1-3% of them per year have issued <a href="http://reducing-suffering.org/advanced-tips-on-personal-finance/#Tender_offers">tender offers</a> requiring shareholders to either accept the offer or sell the security before it becomes worthless. If you miss the deadline, you just lost the value of the security.

If you already have assets with another broker, you should use <a href="http://ibkb.interactivebrokers.com/video/1136" title="&quot;How to Deposit Funds Via a Full ACATS/ATON Transfer&quot;">ACATS</a> to transfer your securities to Interactive Brokers. You shouldn't sell your securities and then wire the money, because this incurs capital-gains tax! Select only a "Partial" transfer unless you want to move your whole brokerage account. Doing only a partial transfer <a href="http://www.moneycone.com/switching-brokers-what-you-need-to-know-to-avoid-getting-hit-with-fees/" title="&quot;Switching brokers? What you need to know to avoid getting hit with fees!&quot;">might save on ACAT fees</a> by your old broker. If you have shares purchased using ESPP, you may need a special form for transferring, so call your broker about that. Since Interactive Brokers says in the quote from the previous paragraph that they may not report <a href="https://en.wikipedia.org/wiki/Corporate_action">corporate actions</a>, I didn't transfer big amounts of small/mid-cap stocks to Interactive Brokers in case Interactive Brokers's reporting of tender offers/etc. is inferior to that of my existing broker, but I hope to learn more about this over time.
<!--
ADD:

http://en.wikipedia.org/wiki/Portfolio_margin vs. Regulation T
-->

<h2>Social impact of leverage</h2>

Using leverage to increase the amount you can donate to charity is very likely a net positive socially. That said, it's worth thinking about the direct social impact of using margin. Usually people say that margin investing increases financial instability by amplifying both positive and negative returns. When the market declines, people using leverage have too much debt and so need to sell some of their positions to restore their leverage ratios, which pushes prices down further.

Margin investing also slightly increases demand for loans, pushing interest rates slightly higher. I would also guess that when more money is invested in stocks, the willingness of companies to IPO increases slightly, since companies can expect higher prices for their initial shares, but I haven't read this anywhere, so it could be completely wrong. These seem like small effects, and it's not obvious if they're good or bad anyway.

<h2>Footnotes</h2>